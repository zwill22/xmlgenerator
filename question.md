That fixes most of the problems. However, there are still some minor issues to work out. 
The code does not check whether the input schema is actually valid.
The code should validate the input xsd is a valid schema by validating it against its own schema. 
